{
  "$schema": "https://mova.dev/schemas/mova.control_v0.schema.json",
  "version": "control_v0",
  "claude_md": {
    "inject_control_entry": true,
    "marker": "<!-- MOVA_CONTROL_ENTRY_V0 -->",
    "priority_sources": ["CLAUDE.md", ".claude/CLAUDE.md", "~/.claude/CLAUDE.md"]
  },
  "claude_memory": {
    "enable": true,
    "sources": ["CLAUDE.md"]
  },
  "overlay": {
    "enable": true
  },
  "settings": {
    "include_co_authored_by": true,
    "env": {}
  },
  "mcp": {
    "servers": {
      "context7": {
        "command": "cmd",
        "args": ["/c", "npx", "-y", "@upstash/context7-mcp@latest"]
      }
    },
    "enable_all_project_mcp_servers": false,
    "enabled_mcpjson_servers": ["context7"],
    "env_substitutions": {
      "format": "${VAR}",
      "default_format": "${VAR:-default}"
    }
  },
  "policy": {
    "mode": "report_only",
    "hooks": {
      "enable": true,
      "on_invalid_hook": "report_only",
      "definitions": [],
      "events": {
        "PreToolUse": [
          {
            "matcher": "Edit|MultiEdit|Write",
            "hooks": [
              {
                "type": "command",
                "command": "[ \"$(git branch --show-current)\" != \"main\" ] || { echo '{\"block\": true, \"message\": \"Cannot edit files on main branch. Create a feature branch first.\"}' >&2; exit 2; }",
                "timeout": 5
              }
            ]
          },
          {
            "matcher": "Bash",
            "hooks": [
              {
                "type": "command",
                "command": "if echo \"$CLAUDE_TOOL_INPUT\" | grep -E -i \"(rm\\\\s+-rf|sudo|curl\\\\s+[^|]+\\\\|\\\\s*sh|wget\\\\s+[^|]+\\\\|\\\\s*sh|mkfs\\\\.|dd\\\\s+if=|chmod\\\\s+777|chown\\\\s+root|\\\\.env|id_rsa|\\\\.pem)\"; then\n  echo '{\"block\": true, \"message\": \"Potentially dangerous command blocked.\"}' >&2\n  exit 2\nfi",
                "timeout": 5
              }
            ]
          }
        ],
        "PostToolUse": [
          {
            "matcher": "Edit|MultiEdit|Write",
            "hooks": [
              {
                "type": "command",
                "command": "if [[ \"$CLAUDE_TOOL_INPUT_FILE_PATH\" =~ \\\\.(js|jsx|ts|tsx)$ ]]; then\n  npx prettier --write \"$CLAUDE_TOOL_INPUT_FILE_PATH\" 2>&1\n  exit_code=$?\n  if [ $exit_code -ne 0 ]; then\n    echo '{\"feedback\": \"Formatting failed.\"}' >&2\n    exit 1\n  fi\n  echo '{\"feedback\": \"Formatting applied.\", \"suppressOutput\": true}'\nfi",
                "timeout": 30
              }
            ]
          },
          {
            "matcher": "Edit|MultiEdit|Write",
            "hooks": [
              {
                "type": "command",
                "command": "if [[ \"$CLAUDE_TOOL_INPUT_FILE_PATH\" =~ \\\\.test\\\\.(js|jsx|ts|tsx)$ ]]; then\n  npm test -- --findRelatedTests \"$CLAUDE_TOOL_INPUT_FILE_PATH\" --passWithNoTests 2>&1 | tail -30\n  exit 0\nfi",
                "timeout": 90
              }
            ]
          }
        ],
        "UserPromptSubmit": [
          {
            "hooks": [
              {
                "type": "command",
                "command": ".claude/hooks/skill-eval.sh",
                "timeout": 5
              }
            ]
          }
        ]
      }
    },
    "permissions": {
      "allow": ["Bash", "Edit", "Read"],
      "deny": [],
      "on_conflict": "deny_wins",
      "on_unknown": "report_only"
    },
    "plugins": {
      "enable": true,
      "allowed_plugin_ids": [],
      "denied_plugin_ids": [],
      "on_unknown": "report_only",
      "enabled_plugins": {}
    }
  },
  "lsp": {
    "enabled_plugins": [],
    "config_path": ".claude/lsp.json",
    "managed": false
  },
  "skill_eval": {
    "enable": true,
    "hooks": {
      "shell": ".claude/hooks/skill-eval.sh",
      "node": ".claude/hooks/skill-eval.js"
    },
    "rules_path": ".claude/hooks/skill-rules.json",
    "scoring": {
      "threshold": 0.6
    }
  },
  "observability": {
    "enable": true,
    "mode": "report_only",
    "writer": {
      "type": "node",
      "script_path": ".claude/hooks/mova-observe.js"
    },
    "output_dir": ".mova/episodes",
    "stdout_tail_bytes": 4000,
    "stderr_tail_bytes": 4000,
    "max_event_bytes": 20000,
    "tail_lines": 50,
    "include_tools": ["Bash", "Read", "Edit", "MultiEdit", "Write"],
    "include_events": ["PostToolUse", "UserPromptSubmit", "Stop"]
  },
  "assets": {
    "skills": [
      {
        "path": ".claude/skills/testing-patterns/SKILL.md",
        "mode": "copy_through",
        "source_path": ".claude/skills/testing-patterns/SKILL.md"
      },
      {
        "path": ".claude/skills/systematic-debugging/SKILL.md",
        "mode": "copy_through",
        "source_path": ".claude/skills/systematic-debugging/SKILL.md"
      },
      {
        "path": ".claude/skills/security-basics/SKILL.md",
        "mode": "copy_through",
        "source_path": ".claude/skills/security-basics/SKILL.md"
      },
      {
        "path": ".claude/skills/git-workflow/SKILL.md",
        "mode": "copy_through",
        "source_path": ".claude/skills/git-workflow/SKILL.md"
      }
    ],
    "agents": [
      {
        "path": ".claude/agents/code-reviewer.md",
        "mode": "copy_through",
        "source_path": ".claude/agents/code-reviewer.md"
      }
    ],
    "commands": [
      {
        "path": ".claude/commands/start.md",
        "mode": "copy_through",
        "source_path": ".claude/commands/start.md"
      },
      {
        "path": ".claude/commands/finish.md",
        "mode": "copy_through",
        "source_path": ".claude/commands/finish.md"
      }
    ],
    "rules": [
      {
        "path": ".claude/rules/code-style.md",
        "mode": "copy_through",
        "source_path": ".claude/rules/code-style.md"
      },
      {
        "path": ".claude/rules/security.md",
        "mode": "copy_through",
        "source_path": ".claude/rules/security.md"
      }
    ],
    "hooks": [
      {
        "path": ".claude/hooks/skill-eval.sh",
        "mode": "copy_through",
        "source_path": ".claude/hooks/skill-eval.sh"
      },
      {
        "path": ".claude/hooks/skill-eval.js",
        "mode": "copy_through",
        "source_path": ".claude/hooks/skill-eval.js"
      },
      {
        "path": ".claude/hooks/skill-rules.json",
        "mode": "copy_through",
        "source_path": ".claude/hooks/skill-rules.json"
      }
    ],
    "workflows": [],
    "docs": [],
    "dotfiles": [],
    "schemas": []
  }
}
